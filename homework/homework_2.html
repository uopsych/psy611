<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="YOUR NAME HERE">

<title>PSY 611 Homework #2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="homework_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="homework_2_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="homework_2_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="homework_2_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="homework_2_files/libs/quarto-html/popper.min.js"></script>
<script src="homework_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="homework_2_files/libs/quarto-html/anchor.min.js"></script>
<link href="homework_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="homework_2_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="homework_2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="homework_2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="homework_2_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PSY 611 Homework #2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>YOUR NAME HERE </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="instructions" class="level1">
<h1>Instructions</h1>
<p>Please complete this assignment using the RMarkdown file provided. Once you download the RMarkdown file please (1) include your name in the preamble, (2) rename the file to include your last name (e.g., “weston-homework-1.Rmd”). When you turn in the assignment, include both the .Rmd and knitted .docx files.</p>
<p>To receive full credit on this homework assignment, you must earn <strong>30 points</strong>. You may notice that the total number of points available to earn on this assignment is 65 – this means you do not have to answer all of the questions. You may choose which questions to answer. You cannot earn more than 30 points, but it may be worth attempting many questions. Here are a couple things to keep in mind:</p>
<ol type="1">
<li><p>Points are all-or-nothing, meaning you cannot receive partial credit if you correctly answer only some of the bullet points for a question. All must be answered correctly.</p></li>
<li><p>After the homework has been graded, you may retry questions to earn full credit, but you may only retry the questions you attempted on the first round.</p></li>
<li><p>The first time you complete this assignment, it must be turned in by 9am on the due date (November 12). Late assignments will receive 50% of the points earned. For example, if you correctly answer questions totaling 28 points, the assignment will receive 14 points. If you resubmit this assignment with corrected answers (a total of 30 points), the assignment will receive 15 points.</p></li>
<li><p>You may discuss homework assignments with your classmates; however, it is important that you complete each assignment on your own and do not simply copy someone else’s code. If we believe one student has copied another’s work, both students will receive a 0 on the homework assignment and will not be allowed to resubmit the assignment for points.</p></li>
</ol>
<p><strong>Data:</strong> Some of the questions in this assignment use the dataset referred to as <code>homework-avengers</code>. This dataset contains data on every movie in the Marvel Cinematic Universe from <em>Iron Man</em> (2008) through <em>Captain Marvel</em> (2019), including the budget, number of screens it was released on, year of release, and gross earnings in the United States (<code>DomesticGross</code>), over the first weekend (<code>WeekendGross</code>), internationally (<code>OverseasGross</code>) and total (<code>WorldwideGross</code>). It also contains a character variable for each character (pun not intended) in the MCU, which takes the value of <code>"yes"</code> if that character was in that movie and <code>"no"</code> if that character was not in that movie.</p>
</section>
<section id="point-questions" class="level1">
<h1>2-point questions</h1>
<section id="question-1" class="level3">
<h3 class="anchored" data-anchor-id="question-1">Question 1</h3>
<p>You draw a sample of 43 cases and calculate the mean to be 102. Determine how probable it is that you would get a sample mean of 102 or more in a normally distributed population with the following parameters:</p>
<ul>
<li><p><span class="math inline">\(\mu = 105\)</span>, <span class="math inline">\(\sigma = 11\)</span></p></li>
<li><p><span class="math inline">\(\mu = 94\)</span>, <span class="math inline">\(\sigma = 5\)</span></p></li>
<li><p><span class="math inline">\(\mu = 83,\)</span> <span class="math inline">\(\sigma = 25\)</span></p></li>
<li><p><span class="math inline">\(\mu = 110\)</span>, <span class="math inline">\(\sigma = 50\)</span></p></li>
<li><p><span class="math inline">\(\mu = 121\)</span>, <span class="math inline">\(\hat{\sigma}=22\)</span></p></li>
<li><p><span class="math inline">\(\mu = 115\)</span>, <span class="math inline">\(\hat{\sigma}=75\)</span></p></li>
</ul>
</section>
<section id="question-2" class="level3">
<h3 class="anchored" data-anchor-id="question-2">Question 2</h3>
<p>A colleague designs a classroom test, administers it year after year to a very large number of students, claims the distribution is normal, and tells you that the middle 50% of the scores fall between 45 and 67.</p>
<ul>
<li><p>What is the mean and standard deviation of this test?</p></li>
<li><p>How likely would it be for a student to receive a grade of 83 or higher?</p></li>
</ul>
</section>
<section id="question-3" class="level3">
<h3 class="anchored" data-anchor-id="question-3">Question 3</h3>
<p>You randomly sample the cell phone records of 5000 college students to determine the number of text messages sent during a typical school day (Monday through Friday). You find the mean to be 124.6 with a standard deviation of 21.2. What is the 99% confidence interval for the true mean based on these data?</p>
</section>
<section id="question-4" class="level3">
<h3 class="anchored" data-anchor-id="question-4">Question 4</h3>
<ul>
<li>Use the <code>pirates</code> dataset in the <code>{yarrr}</code> package to create a graphic that communicates the associations between the time it takes to draw a sword and number of treasure chests found, by sword type. Use the <code>facet_wrap()</code> function, and set the argument <code>scales</code> to <code>"free"</code>. Be sure your graph includes a title, properly labelled axes, and a caption.</li>
</ul>
</section>
<section id="question-5" class="level3">
<h3 class="anchored" data-anchor-id="question-5">Question 5</h3>
<p>Use the <code>homework-avengers</code> to answer the following questions (Note: you may choose to use tidyverse functions or not, whichever make more sense to you):</p>
<ul>
<li><p>What’s the average amount of money Marvel makes per movie?</p></li>
<li><p>How many movies is Nick Fury in?</p></li>
<li><p>Do Black Widow movies make more domestically or internationally?</p></li>
<li><p>Does the average number of domestic screens per movie increase by year of release?</p></li>
</ul>
</section>
</section>
<section id="point-questions-1" class="level1">
<h1>5-point questions</h1>
<section id="question-1-1" class="level3">
<h3 class="anchored" data-anchor-id="question-1-1">Question 1</h3>
<p>You are studying whether an SSRI is effective for 80% of patients. You randomly sample 12 patients.</p>
<ul>
<li>How many patients you expect to report that the medication is effective?</li>
<li>You find that only 3 of your 12 patients report the medication is effective. How likely is this finding if the SSRI is indeed effective for 80% of patients?</li>
</ul>
</section>
<section id="question-2-1" class="level3">
<h3 class="anchored" data-anchor-id="question-2-1">Question 2</h3>
<p>Which avengers character do you believe brings in the most money? Using the <code>homework-avengers</code> dataset, create a figure that demonstrates the relationship between budget and worldwide gross earnings. Use the color aesthetic to indicate whether a movie does or does not contain your character. Be sure your graph includes a title and appropriate labels.</p>
<ul>
<li>Based on this graph, what do you conclude regarding whether movies including this character make more than projected?</li>
</ul>
</section>
<section id="question-3-1" class="level3">
<h3 class="anchored" data-anchor-id="question-3-1">Question 3</h3>
<p>Data released by the Graduate Coffee Drinkers Association (GCDA) indicate that the average graduate student drinks 5 cups of coffee a day and the standard deviation of coffee consumption in the population is 1. You suspect that graduate students at the University of Oregon are unusual, in part because of the number of independent coffee roasters in the state and in part because they have to complete such arduous statistics assignments. You poll 10 of your fellow graduate students and find the average number of cups of coffee consumed is 5.7.</p>
<ul>
<li><p>What must be true of the way you conducted your poll in order for you to use NHST?</p></li>
<li><p>What are your null and alternative hypotheses (in words or in math)?</p></li>
<li><p>What kind of probability distribution will you use to test your hypotheses? <strong>Justify your choice.</strong></p></li>
<li><p>What alpha level will you set for your test. <strong>Justify your choice.</strong></p></li>
<li><p>What is the standard deviation of your sampling distribution?</p></li>
<li><p>Conduct your statistical test (use a two-tailed test). What is the p-value? What do you conclude?</p></li>
<li><p>Calculate a confidence interval around the population mean. The width of this confidence interval should be correspond to your chosen alpha level (e.g., if you chose an alpha of .01, your confidence interval should be .99). Does it include your sample mean?</p></li>
<li><p>Calculate a confidence interval around your sample mean. Does it include the population mean?</p></li>
</ul>
</section>
</section>
<section id="point-questions-2" class="level1">
<h1>10-point questions</h1>
<section id="question-1-2" class="level3">
<h3 class="anchored" data-anchor-id="question-1-2">Question 1</h3>
<p>The probability distribution functions beginning with r (e.g., <code>rbinom</code>, <code>rnorm</code>, <code>rchisq</code>, etc) can be used to simulate drawing from a known distribution many times, if you set the <code>n</code> parameter to a large integer, like 10000. Using this method of simulation, demonstrate each of the following:</p>
<ul>
<li><p>The distribution of squared Z-scores is equal to <span class="math inline">\(\chi^2_1\)</span>.</p></li>
<li><p>The distribution of summed squared Z-scores is equal to <span class="math inline">\(\chi^2_N\)</span>. (Do this for N = 2, 5, and 10).</p></li>
</ul>
<p>For each demonstration, do the following: 1. Plot a histogram of your simulated data and a density distribution based on a theoretical probability distribution on the same plot. 2. Show that the mean of your simulated data are approximately equal to the mean of your theoretical probability distribution.</p>
</section>
<section id="question-2-2" class="level3">
<h3 class="anchored" data-anchor-id="question-2-2">Question 2</h3>
<p>A commonly used distribution is the Poisson distribution. This is useful when you want to estimate the number of times an event E occurs, but there is no specific set of trials, only a specific space or time interval. This distribution is especially useful for estimating the likelihood of experiencing a number of rare events, for example, the number of traffic accidents at a particular intersection. There is no set “number of trials” in this scenario – would it be the number of times a car approaches the interaction? the number of minutes a car is at an intersection? the number of seconds? You can see where this goes. We can’t use the binomial, so instead, we turn to the Poisson.</p>
<p>The Poisson is a single-parameter distribution defined by <span class="math inline">\(\lambda\)</span> (“lambda”) which is the rate of event occurrence, or the typical number of events during the space or time interval of interest.</p>
<p>Use the distribution functions for the Poisson (<code>dpois</code>, <code>ppois</code>, <code>qpois</code> and <code>rpois</code>) to answer the following questions:</p>
<ul>
<li><p>Graph the probability distributions for <span class="math inline">\(\lambda = 1\)</span>, <span class="math inline">\(\lambda = 4\)</span> and <span class="math inline">\(\lambda = 10\)</span>. What do you notice about the shape of the Poisson as <span class="math inline">\(\lambda\)</span> increases?</p></li>
<li><p>Using <code>rpois</code> generate a large sample from the Poisson distribution defined by <span class="math inline">\(\lambda = 1\)</span>. What is the expected value of the Poisson distribution defined by <span class="math inline">\(\lambda = 1\)</span>? What about for the distributions defined by <span class="math inline">\(\lambda = 4\)</span> and <span class="math inline">\(\lambda = 10\)</span>?</p></li>
<li><p>Using <code>rpois</code> generate a large sample from the Poisson distribution defined by <span class="math inline">\(\lambda = 1\)</span>. What is the variance of this distribution? Do the same thing for the distributions defined by <span class="math inline">\(\lambda = 4\)</span> and <span class="math inline">\(\lambda = 10\)</span>.</p></li>
<li><p>How would you express the mean and variance of the Poisson distribution in terms of its parameter, <span class="math inline">\(\lambda\)</span>?</p></li>
<li><p>Are the mean and variance of the Poisson distribution independent from each other?</p></li>
</ul>
</section>
<section id="question-3-2" class="level3">
<h3 class="anchored" data-anchor-id="question-3-2">Question 3</h3>
<p>This question is designed to help you learn and practice ethical and useful ways of using AI as a statistical thinking and coding tool. You will use an AI tool to deepen your conceptual understanding of when and how to use different probability distributions.</p>
<p><strong>Tasks:</strong></p>
<ul>
<li><p><strong>Use AI to explore distribution concepts</strong>: Use an AI tool (such as ChatGPT, Claude, or another tool of your choice) to help you understand: “What are the key assumptions and appropriate use cases for chi-square and Poisson distributions? How do they relate to other distributions I’ve learned about (normal, binomial)?” Include a screenshot or copy-paste of the AI’s response in your homework.</p></li>
<li><p><strong>Create a decision guide</strong>: Based on the AI’s response and your own understanding, create a brief “decision tree” or flowchart showing when to use each of the following distributions: normal, binomial, chi-square, and Poisson. This can be hand-drawn and photographed, created in R, or made with any other tool. The key is that it should help someone decide which distribution to use for a given scenario.</p></li>
<li><p><strong>Identify potential pitfalls</strong>: Identify 2-3 potential misunderstandings or misuses of chi-square and/or Poisson distributions that the AI mentioned (or that you can think of after consulting the AI).</p></li>
<li><p><strong>Generate new examples</strong>: Create one example scenario (that’s NOT in the homework) where the chi-square distribution would be appropriate, and one where the Poisson distribution would be appropriate. For each scenario, explain why that distribution is the right choice.</p></li>
<li><p><strong>Reflection</strong>: Write a few sentences addressing the following:</p>
<ul>
<li>What connections between distributions did the AI help you understand that you hadn’t fully grasped before?</li>
<li>Were there any explanations that seemed incorrect, incomplete, or that you needed to verify with other sources (like your textbook or course notes)? If so, what were they?</li>
<li>How has this deeper understanding changed how you think about choosing appropriate statistical tests or distributions?</li>
<li>What did you learn about using AI as a tool for statistical learning? What are its strengths and limitations?</li>
</ul>
<h1 id="point-questions-3">20-point questions</h1></li>
</ul>
</section>
<section id="question-1-3" class="level3">
<h3 class="anchored" data-anchor-id="question-1-3">Question 1</h3>
<p>You would like to be 99% confident that the mean from a sample falls within K standard deviations of a population mean. (Assume you know both the population mean and standard deviation.)</p>
<ul>
<li><p>Construct a graph showing how the magnitude of K changes with sample sizes ranging between 1 and 100.</p></li>
<li><p>How does the relationship of K by change sample size if you’re willing to be only 95% confident? Include both relationships in the same graph.</p></li>
<li><p>How big does your sample size need to be if you want to be 99% confident that your sample mean is .5 standard deviations away from the population mean?</p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>